name: E2E Cypress Tests

# Trigger: Run this workflow on every push to the 'main' branch
on:
  push:
    branches:
      - main

jobs:
  cypress-run:
    # Execution Environment: Run on the latest Ubuntu virtual machine
    runs-on: ubuntu-latest

    steps:
      # 1. Checkout Code
      # Retrieves the latest code from your repository so the runner can access it
      - name: Checkout Code
        uses: actions/checkout@v4

      # 2. Run Cypress Tests
      # Uses the official Cypress GitHub Action to:
      # - Install Node.js and dependencies (npm install)
      # - Cache node modules for faster performance
      # - Execute the tests using the Chrome browser
      - name: Run Cypress Tests
        uses: cypress-io/github-action@v6
        with:
          browser: chrome
          # Ensure this command matches your package.json script
          command: npx cypress run

      # 3. Upload Screenshots (On Failure Only)
      # If the test fails, upload screenshots as artifacts for debugging
      - name: Upload Screenshots
        if: failure()
        uses: actions/upload-artifact@v4
        with:
          name: cypress-screenshots
          path: cypress/screenshots

      # 4. Upload Videos (On Failure Only)
      # Upload video recordings of the failed tests for playback and analysis
      - name: Upload Videos
        if: failure() 
        uses: actions/upload-artifact@v4
        with:
          name: cypress-videos
          path: cypress/videos